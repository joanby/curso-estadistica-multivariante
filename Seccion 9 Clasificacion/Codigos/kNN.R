
##################################################################################################################
##################################################################################################################
# Clasificación kNN
##################################################################################################################
##################################################################################################################

set.seed(1000)

##################################################################################################################
# Cargar librería MASS
##################################################################################################################

library(MASS)

##################################################################################################################
# Cargar los datos Iris
##################################################################################################################

Z <- as.data.frame(iris)
Z

##################################################################################################################
# Definir la matriz de datos y la variable respuesta con las clasificaciones 
##################################################################################################################

X <- Z[,1:4]
X

y <- Z[,5]
y

##################################################################################################################
# Definir como n y p el número de flores y el número de variables
##################################################################################################################

n <- nrow(X)
n
p <- ncol(X)
p

##################################################################################################################
# Scatterplot matrix
##################################################################################################################

col.iris <- c("blue","green","orange")[y]
col.iris

pairs(X,main="Iris data set",pch=19,col=col.iris)

##################################################################################################################
##################################################################################################################
# Clasificación con kNN
##################################################################################################################
##################################################################################################################

library(class)

# Para k=1 hasta k=20

knn.class <- vector(mode="list",length=20)
knn.tables <- vector(mode="list",length=20)
knn.mis <- matrix(NA,nrow=20,ncol=1)
for (k in 1 : 20){
  knn.class[[k]] <- knn.cv(X,y,k=k)
  knn.tables[[k]] <- table(y,knn.class[[k]])  
  knn.mis[k] <- n - sum(y==knn.class[[k]])
}
knn.mis

# El número óptimo k de vecinos

which(knn.mis==min(knn.mis))

knn.tables[[14]]
knn.tables[[18]]
knn.tables[[19]]

k.opt <- 14
k.opt

# Veamos la clasificación para este valor de k

knn.cv.opt <- knn.class[[k.opt]]
knn.cv.opt

# Tabla de contingencia con las clasificaciones buenas y malas

knn.tables[[k.opt]]

# Cantidad de observaciones mal clasificadas

knn.mis[k.opt]

# Error MR

knn.mis[k.opt]/n

# Gráfico, buenas clasificaciones en rojo, mal clasificadas en negro

col.knn.iris <- c("black","indianred1")[1*(y==knn.cv.opt)+1]
pairs(X,main="Good (in red) and bad (in black) classifications for the Iris data set with k-NN",pch=19,col=col.knn.iris)
